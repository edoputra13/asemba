<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Daftar Pelanggan</title>

<style>
:root{
  --bg:#f1f5fb;
  --card:#ffffff;
  --soft:#eef4ff;
  --shadow:0 14px 40px rgba(15,23,42,.1);
  --warn:#f59e0b;
  --danger:#ef4444;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:linear-gradient(180deg,var(--soft),var(--bg));
  color:#0f172a;
}

/* HEADER */
header{
  position:sticky;top:0;z-index:50;
  padding:16px 22px;
  background:linear-gradient(135deg,#cfe7ff,#ffffff,#e0f2fe);
  border-radius:0 0 24px 24px;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:var(--shadow);
}

/* LAYOUT */
.container{max-width:1000px;margin:36px auto;padding:20px}

/* CARD */
.card{
  background:var(--card);
  border-radius:20px;
  box-shadow:var(--shadow);
  padding:20px;
  margin-bottom:20px;
}

/* SEARCH */
#search-customer{
  width:100%;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #cbd5e1;
  margin-bottom:10px;
  font-size:14px;
  outline:none;
}
#search-customer:focus{
  border-color:#60a5fa;
  box-shadow:0 0 0 3px rgba(96,165,250,.25);
}

/* SEARCH HISTORY */
#search-history{
  display:none;
  background:#fff;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(15,23,42,.08);
  padding:8px;
  margin-bottom:14px;
}
.history-item{
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.history-item:hover{background:#eef2ff}

/* CUSTOMER */
.customer{
  display:flex;align-items:center;gap:12px;
  padding:14px;border-radius:16px;
  cursor:pointer;margin-bottom:10px;
  background:linear-gradient(135deg,#f8fafc,var(--soft));
}
.avatar{
  width:42px;height:42px;border-radius:50%;
  background:linear-gradient(135deg,#60a5fa,#2563eb);
  color:#fff;font-weight:700;
  display:flex;align-items:center;justify-content:center;
}

/* DETAIL */
.detail{
  display:none;
  transition:opacity .2s ease, transform .2s ease;
}
.detail.show{
  display:block;
  opacity:1;
  transform:translateY(0);
}

/* PRODUCT */
.product{
  background:#f9fbff;
  border-radius:16px;
  padding:14px 16px;
  margin-bottom:14px;
  box-shadow:0 6px 20px rgba(15,23,42,.08);
}

/* PROGRESS */
.progress{
  height:6px;background:#e5e7eb;
  border-radius:999px;overflow:hidden;
  margin-top:8px;
}
.progress div{
  height:100%;
  background:linear-gradient(90deg,#22c55e,#4ade80);
}

/* BADGE */
.badge{
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  font-weight:700;
  margin-left:6px;
  display:inline-flex;
  align-items:center;
}

/* HABIS */
.badge.exp{
  background:#fee2e2;
  color:#991b1b;
}

/* HAMPIR HABIS */
.badge.warn{
  background:#fef3c7;
  color:#92400e;
  position:relative;
  overflow:hidden;
  animation:pulse 1.6s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(245,158,11,.5)}
  70%{box-shadow:0 0 0 8px rgba(245,158,11,0)}
  100%{box-shadow:0 0 0 0 rgba(245,158,11,0)}
}
.badge-text{
  display:inline-block;
  white-space:nowrap;
  animation:fadeSwap 5s infinite;
}
@keyframes fadeSwap{
  0%{opacity:1}
  45%{opacity:1}
  50%{opacity:0;transform:translateY(-4px)}
  60%{opacity:1;transform:none}
  100%{opacity:1}
}
</style>
</head>

<body>

<header>
  <strong>Daftar Customer</strong>
</header>

<div class="container">

  <div class="card">
    <h3>Nama Customer</h3>

    <input id="search-customer" placeholder="Cari nama pelanggan...">
    <div id="search-history"></div>

    <div id="customer-list"></div>
  </div>

  <div class="card detail" id="detail">
    <h3 id="cust-name"></h3>
    <div id="product-list"></div>
  </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const HISTORY_KEY='customer_search_history';

  const products=[
    {id:1,name:'Disney'},
    {id:2,name:'Disney'},
    {id:3,name:'Disney'},
    {id:4,name:'Disney'}
  ];

  const customers=[
    {name:'Andi Pratama',rentals:[
      {productId:1,end:'2025-12-20T18:00:00'},
      {productId:3,end:'2025-12-18T12:00:00'}
    ]},
    {name:'Siti Aisyah',rentals:[
      {productId:2,end:'2025-12-15T09:00:00'}
    ]}
  ];

  const list=document.getElementById('customer-list');
  const detail=document.getElementById('detail');
  const cname=document.getElementById('cust-name');
  const plist=document.getElementById('product-list');
  const searchInput=document.getElementById('search-customer');
  const historyBox=document.getElementById('search-history');

  /* Render pelanggan */
  customers.forEach(c=>{
    const div=document.createElement('div');
    div.className='customer';
    div.innerHTML=`<div class="avatar">${c.name[0]}</div><strong>${c.name}</strong>`;
    div.onclick=()=>showDetail(c);
    list.appendChild(div);
  });

  function showDetail(c){
    cname.textContent=c.name;
    plist.innerHTML='';
    detail.classList.add('show');

    c.rentals.forEach(r=>{
      const p=products.find(x=>x.id===r.productId);
      if(!p) return;

      const now=Date.now();
      const end=new Date(r.end).getTime();
      const left=end-now;

      let percent=left>0?Math.min(100,Math.max(5,(left/(left+86400000))*100)):0;

      let badge='';
      if(left<=0){
        badge='<span class="badge exp">HABIS</span>';
      }else if(left<86400000){
        const endDate=new Date(r.end).toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'});
        badge=`<span class="badge warn">
          <span class="badge-text">HAMPIR HABIS</span>
          <span class="badge-text">: ${endDate}</span>
        </span>`;
      }

      const box=document.createElement('div');
      box.className='product';
      box.innerHTML=`
        <strong>${p.name}</strong>${badge}
        <div class="progress"><div style="width:${percent}%"></div></div>
      `;
      plist.appendChild(box);
    });
  }

  /* Klik sembarang untuk menutup detail */
  document.addEventListener('click',e=>{
    if(!detail.classList.contains('show')) return;
    if(!e.target.closest('.customer') && !e.target.closest('#detail')){
      detail.classList.remove('show');
    }
  });

  /* SEARCH + HISTORY */
  function getHistory(){return JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]');}
  function saveHistory(t){
    if(!t) return;
    let h=getHistory().filter(x=>x!==t);
    h.unshift(t); h=h.slice(0,5);
    localStorage.setItem(HISTORY_KEY,JSON.stringify(h));
  }
  function renderHistory(){
    const h=getHistory();
    if(!h.length){historyBox.style.display='none';return;}
    historyBox.innerHTML=h.map(x=>`<div class="history-item">${x}</div>`).join('');
    historyBox.style.display='block';
    historyBox.querySelectorAll('.history-item').forEach(i=>{
      i.onclick=()=>{
        searchInput.value=i.textContent;
        filterCustomers(i.textContent);
        historyBox.style.display='none';
      };
    });
  }
  function filterCustomers(t){
    t=t.toLowerCase();
    document.querySelectorAll('.customer').forEach(c=>{
      c.style.display=c.textContent.toLowerCase().includes(t)?'flex':'none';
    });
  }

  searchInput.addEventListener('input',()=>filterCustomers(searchInput.value));
  searchInput.addEventListener('focus',renderHistory);
  searchInput.addEventListener('blur',()=>setTimeout(()=>{
    saveHistory(searchInput.value.trim());
    historyBox.style.display='none';
  },200));

});
</script>

</body>
</html>

